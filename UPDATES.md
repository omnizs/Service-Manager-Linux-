# Automatic Updates System

Service Manager uses `electron-updater` to provide automatic updates for packaged applications.

## How It Works

### For Packaged Apps (Recommended)

When you distribute Service Manager as a packaged application (via Windows installer, macOS DMG, or Linux AppImage), the app automatically checks for updates:

1. **On Startup**: Checks for updates when the app launches
2. **Scheduled Checks**: Checks every 4 hours while the app is running
3. **Auto-Download**: New updates are downloaded automatically in the background
4. **User Notification**: Users are notified when an update is ready to install
5. **Auto-Install**: Updates install automatically on app quit, or users can restart immediately

### For NPM Installations

If installed via `npm install -g @omnizs/service-manager`, the app checks the npm registry for updates and displays installation instructions to the user.

### For Development (Source)

No automatic updates. Developers should manually pull the latest changes from the repository.

## Release Process

To create a new release with automatic updates:

1. **Update Version**: Bump version in `package.json`
   ```bash
   npm version patch  # or minor, or major
   ```

2. **Create Git Tag**: Push the version tag to GitHub
   ```bash
   git push origin v2.6.2  # Replace with your version
   ```

3. **GitHub Actions**: The workflow automatically:
   - Builds the app for Windows, macOS, and Linux
   - Creates a GitHub release
   - Uploads installers and update metadata (`.yml` files)
   - Publishes to electron-updater's update server

4. **Users Get Updated**: Packaged apps automatically detect and download the new version

## Update Metadata Files

The following files are crucial for electron-updater:

- **`latest.yml`** (Windows): Contains update info for Windows apps
- **`latest-mac.yml`** (macOS): Contains update info for macOS apps  
- **`latest-linux.yml`** (Linux): Contains update info for Linux apps

These files are automatically generated by `electron-builder` and uploaded to GitHub releases.

## Configuration

### package.json

```json
{
  "build": {
    "publish": [
      {
        "provider": "github",
        "owner": "omnizs",
        "repo": "Service-Manager",
        "releaseType": "release"
      }
    ]
  }
}
```

### electron-updater Settings

Configured in `src/main/updater.ts`:

- **autoDownload**: `true` - Downloads updates automatically
- **autoInstallOnAppQuit**: `true` - Installs on app close
- **allowPrerelease**: `false` - Only stable releases
- **allowDowngrade**: `false` - No downgrades
- **Check Interval**: 4 hours

## Logs

Update logs are stored in:

- **Windows**: `%USERPROFILE%\AppData\Roaming\Service Manager\logs\main.log`
- **macOS**: `~/Library/Logs/Service Manager/main.log`
- **Linux**: `~/.config/Service Manager/logs/main.log`

Use these logs to debug update issues.

## Testing Updates Locally

To test the update mechanism without publishing:

1. Build a packaged version:
   ```bash
   npm run dist
   ```

2. Create a test GitHub release (draft or pre-release)

3. Upload the generated files from `release/` folder

4. The app will detect the test release (if version is higher)

## Security

- Updates are downloaded over HTTPS
- GitHub releases are signed and verified
- Users must approve installation (or app closes)
- No credentials stored

## Troubleshooting

### Updates Not Detected

- Check internet connectivity
- Verify GitHub release exists with higher version number
- Check logs for errors
- Ensure `.yml` files are uploaded to the release

### Download Fails

- Check firewall/proxy settings
- Verify sufficient disk space
- Review logs for detailed error messages

### Installation Fails

- Ensure app has write permissions
- Check if antivirus is blocking the installer
- Try running as administrator (Windows) or with sudo (Linux/macOS)

## UI Features

- **Version Display**: Current version shown in footer
- **Update Notification**: Toast notification when update is available
- **Download Progress**: Visual progress bar during download
- **Restart Prompt**: Dialog to install immediately or later
- **Manual Check**: Users can check for updates via the menu
